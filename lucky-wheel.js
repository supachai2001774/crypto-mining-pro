// ============ à¸£à¸°à¸šà¸šà¸ à¸²à¸©à¸² ============
const translations = {
    th: {
        title: 'ğŸ° Lucky Wheel & Leaderboard',
        subtitle: 'à¸«à¸¡à¸¸à¸™à¸§à¸‡à¸¥à¹‰à¸­à¸£à¸±à¸šà¸£à¸²à¸‡à¸§à¸±à¸¥ à¹à¸‚à¹ˆà¸‡à¸‚à¸±à¸™à¸­à¸±à¸™à¸”à¸±à¸šà¸œà¸¹à¹‰à¹€à¸¥à¹ˆà¸™',
        theme: 'Dark Mode',
        free: 'à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸Ÿà¸£à¸µ',
        luckyWheel: 'Lucky Wheel',
        leaderboard: 'Leaderboard',
        vipSystem: 'à¸£à¸°à¸šà¸š VIP',
        spin: 'ğŸ° à¸«à¸¡à¸¸à¸™à¹€à¸¥à¸¢!',
        spinsLeft: 'à¸ˆà¸³à¸™à¸§à¸™à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¹€à¸«à¸¥à¸·à¸­à¸§à¸±à¸™à¸™à¸µà¹‰:',
        resetTime: 'à¸£à¸µà¹€à¸‹à¹‡à¸•à¹€à¸§à¸¥à¸² 00:00 à¸™.',
        topPlayers: 'ğŸ† Top 10 à¸œà¸¹à¹‰à¹€à¸¥à¹ˆà¸™à¸­à¸±à¸™à¸”à¸±à¸šà¸•à¹‰à¸™',
        vipDescription: 'à¸­à¸±à¸à¹€à¸à¸£à¸”à¹€à¸›à¹‡à¸™ VIP à¸£à¸±à¸šà¸ªà¸´à¸—à¸˜à¸´à¸à¸´à¹€à¸¨à¸©à¸¡à¸²à¸à¸¡à¸²à¸¢!',
        tierBronze: 'Bronze',
        tierSilver: 'Silver',
        tierGold: 'Gold',
        benefit1: 'à¸«à¸¡à¸¸à¸™à¸§à¸‡à¸¥à¹‰à¸­ 10 à¸„à¸£à¸±à¹‰à¸‡/à¸§à¸±à¸™',
        benefit2: 'à¹‚à¸šà¸™à¸±à¸ªà¸‚à¸¸à¸” +20%',
        benefit3: 'à¸–à¸­à¸™à¹€à¸‡à¸´à¸™à¹„à¸§ 2 à¹€à¸—à¹ˆà¸²',
        benefit4: 'à¸«à¸¡à¸¸à¸™à¸§à¸‡à¸¥à¹‰à¸­à¹„à¸¡à¹ˆà¸ˆà¸³à¸à¸±à¸”',
        benefit5: 'à¹‚à¸šà¸™à¸±à¸ªà¸‚à¸¸à¸” +50%',
        benefit6: 'à¸–à¸­à¸™à¹€à¸‡à¸´à¸™à¸—à¸±à¸™à¸—à¸µ',
        benefit7: 'à¸£à¸²à¸‡à¸§à¸±à¸¥à¸à¸´à¹€à¸¨à¸©à¸—à¸¸à¸à¸§à¸±à¸™',
        benefit8: 'à¹‚à¸šà¸™à¸±à¸ªà¸‚à¸¸à¸” +100%',
        benefit9: 'à¸£à¸²à¸‡à¸§à¸±à¸¥à¸à¸´à¹€à¸¨à¸©à¸—à¸¸à¸à¸§à¸±à¸™ x2',
        benefit10: 'Support 24/7',
        benefit11: 'à¹‚à¸šà¸™à¸±à¸ªà¹à¸™à¸°à¸™à¸³à¹€à¸à¸·à¹ˆà¸­à¸™ +50%',
        upgrade: 'à¸­à¸±à¸à¹€à¸à¸£à¸”',
        congratulations: 'à¸¢à¸´à¸™à¸”à¸µà¸”à¹‰à¸§à¸¢!',
        ok: 'à¸£à¸±à¸šà¸£à¸²à¸‡à¸§à¸±à¸¥'
    },
    en: {
        title: 'ğŸ° Lucky Wheel & Leaderboard',
        subtitle: 'Spin to Win! Compete with Top Players',
        theme: 'Light Mode',
        free: 'Free User',
        luckyWheel: 'Lucky Wheel',
        leaderboard: 'Leaderboard',
        vipSystem: 'VIP System',
        spin: 'ğŸ° Spin Now!',
        spinsLeft: 'Spins Remaining Today:',
        resetTime: 'Reset at 00:00',
        topPlayers: 'ğŸ† Top 10 Players',
        vipDescription: 'Upgrade to VIP for Exclusive Benefits!',
        tierBronze: 'Bronze',
        tierSilver: 'Silver',
        tierGold: 'Gold',
        benefit1: '10 Spins/Day',
        benefit2: 'Mining Bonus +20%',
        benefit3: 'Withdraw 2x Faster',
        benefit4: 'Unlimited Spins',
        benefit5: 'Mining Bonus +50%',
        benefit6: 'Instant Withdraw',
        benefit7: 'Daily Special Rewards',
        benefit8: 'Mining Bonus +100%',
        benefit9: 'Daily Rewards x2',
        benefit10: 'Support 24/7',
        benefit11: 'Referral Bonus +50%',
        upgrade: 'Upgrade',
        congratulations: 'Congratulations!',
        ok: 'Claim Prize'
    }
};

let currentLang = localStorage.getItem('language') || 'th';

function setLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('language', lang);
    document.getElementById('currentLang').textContent = lang === 'th' ? 'à¹„à¸—à¸¢' : 'English';
    
    // à¸­à¸±à¸›à¹€à¸”à¸•à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[lang][key]) {
            element.textContent = translations[lang][key];
        }
    });
    
    toggleLanguage();
}

function toggleLanguage() {
    const dropdown = document.getElementById('langDropdown');
    dropdown.classList.toggle('active');
}

// ============ à¸£à¸°à¸šà¸šà¸˜à¸µà¸¡ ============
let isDarkMode = localStorage.getItem('theme') === 'light' ? false : true;

function toggleTheme() {
    isDarkMode = !isDarkMode;
    const theme = isDarkMode ? 'dark' : 'light';
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    
    const icon = document.getElementById('themeIcon');
    icon.textContent = isDarkMode ? 'ğŸŒ™' : 'â˜€ï¸';
}

// à¹‚à¸«à¸¥à¸”à¸˜à¸µà¸¡à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™
window.addEventListener('load', () => {
    if (!isDarkMode) {
        document.documentElement.setAttribute('data-theme', 'light');
        document.getElementById('themeIcon').textContent = 'â˜€ï¸';
    }
    setLanguage(currentLang);
    renderWheel();
    renderLeaderboard();
});

// ============ Lucky Wheel ============
const prizes = [
    { label: 'à¸¿10', value: 10, color: '#ef4444' },
    { label: 'à¸¿50', value: 50, color: '#f59e0b' },
    { label: 'à¸¿100', value: 100, color: '#10b981' },
    { label: 'à¸¿200', value: 200, color: '#3b82f6' },
    { label: 'à¸¿500', value: 500, color: '#8b5cf6' },
    { label: 'à¸¿1000', value: 1000, color: '#ec4899' },
    { label: 'ğŸ', value: 0, color: '#6366f1' },
    { label: 'à¸¿20', value: 20, color: '#14b8a6' }
];

let spinsRemaining = parseInt(localStorage.getItem('spinsRemaining')) || 3;
let isSpinning = false;

function renderWheel() {
    const wheel = document.getElementById('wheel');
    const segmentAngle = 360 / prizes.length;
    
    prizes.forEach((prize, index) => {
        const segment = document.createElement('div');
        segment.className = 'wheel-segment';
        segment.style.transform = `rotate(${index * segmentAngle}deg)`;
        segment.style.background = prize.color;
        segment.innerHTML = `<span style="transform: rotate(${segmentAngle/2}deg) translateX(60%)">${prize.label}</span>`;
        wheel.appendChild(segment);
    });
    
    updateSpinsDisplay();
}

function updateSpinsDisplay() {
    document.getElementById('spinsRemaining').textContent = spinsRemaining;
    const spinBtn = document.getElementById('spinBtn');
    
    if (spinsRemaining <= 0) {
        spinBtn.disabled = true;
        spinBtn.style.opacity = '0.5';
    } else {
        spinBtn.disabled = false;
        spinBtn.style.opacity = '1';
    }
}

function spinWheel() {
    if (isSpinning || spinsRemaining <= 0) return;
    
    isSpinning = true;
    spinsRemaining--;
    localStorage.setItem('spinsRemaining', spinsRemaining);
    updateSpinsDisplay();
    
    // à¹à¸ªà¸”à¸‡ Loading
    showLoading();
    
    // à¸ªà¸¸à¹ˆà¸¡à¸£à¸²à¸‡à¸§à¸±à¸¥
    const randomIndex = Math.floor(Math.random() * prizes.length);
    const prize = prizes[randomIndex];
    
    // à¸„à¸³à¸™à¸§à¸“à¸¡à¸¸à¸¡à¸«à¸¡à¸¸à¸™
    const segmentAngle = 360 / prizes.length;
    const targetAngle = (randomIndex * segmentAngle) + (segmentAngle / 2);
    const spinRotations = 5; // à¸«à¸¡à¸¸à¸™ 5 à¸£à¸­à¸š
    const finalRotation = (360 * spinRotations) + (360 - targetAngle);
    
    const wheel = document.getElementById('wheel');
    wheel.style.transform = `rotate(${finalRotation}deg)`;
    
    setTimeout(() => {
        hideLoading();
        isSpinning = false;
        showPrize(prize);
        
        // à¸šà¸±à¸™à¸—à¸¶à¸à¸£à¸²à¸‡à¸§à¸±à¸¥
        if (prize.value > 0) {
            const gameData = JSON.parse(localStorage.getItem('miningGameData')) || {};
            gameData.balance = (gameData.balance || 0) + prize.value;
            localStorage.setItem('miningGameData', JSON.stringify(gameData));
        }
    }, 4000);
}

function showPrize(prize) {
    const prizeText = prize.value > 0 
        ? `${currentLang === 'th' ? 'à¸„à¸¸à¸“à¹„à¸”à¹‰à¸£à¸±à¸š' : 'You won'} à¸¿${prize.value}!`
        : `${currentLang === 'th' ? 'à¸„à¸¸à¸“à¹„à¸”à¹‰à¸£à¸±à¸š' : 'You won'} ğŸ ${currentLang === 'th' ? 'à¸‚à¸­à¸‡à¸£à¸²à¸‡à¸§à¸±à¸¥à¸à¸´à¹€à¸¨à¸©' : 'Special Gift'}!`;
    
    document.getElementById('prizeText').textContent = prizeText;
    document.getElementById('prizeModal').classList.add('active');
}

function closeModal() {
    document.getElementById('prizeModal').classList.remove('active');
}

// à¸£à¸µà¹€à¸‹à¹‡à¸•à¸ˆà¸³à¸™à¸§à¸™à¸„à¸£à¸±à¹‰à¸‡à¸«à¸¡à¸¸à¸™à¸—à¸¸à¸à¸§à¸±à¸™
function checkDailyReset() {
    const lastReset = localStorage.getItem('lastWheelReset');
    const today = new Date().toDateString();
    
    if (lastReset !== today) {
        spinsRemaining = 3; // à¸«à¸£à¸·à¸­à¸•à¸²à¸¡à¸£à¸°à¸”à¸±à¸š VIP
        localStorage.setItem('spinsRemaining', spinsRemaining);
        localStorage.setItem('lastWheelReset', today);
        updateSpinsDisplay();
    }
}

setInterval(checkDailyReset, 60000); // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸—à¸¸à¸à¸™à¸²à¸—à¸µ
checkDailyReset();

// ============ Leaderboard ============
let leaderboardData = [
    { rank: 1, username: 'CryptoKing', earnings: 1250890, power: 5678, vip: 'gold' },
    { rank: 2, username: 'MiningPro', earnings: 980450, power: 4321, vip: 'silver' },
    { rank: 3, username: 'DiamondMiner', earnings: 875320, power: 3890, vip: 'gold' },
    { rank: 4, username: 'GoldRush99', earnings: 654210, power: 2456, vip: 'silver' },
    { rank: 5, username: 'BitcoinBoss', earnings: 543890, power: 2134, vip: 'bronze' },
    { rank: 6, username: 'EtherMaster', earnings: 432100, power: 1876, vip: 'bronze' },
    { rank: 7, username: 'MegaMiner', earnings: 387650, power: 1654, vip: null },
    { rank: 8, username: 'CoinCollector', earnings: 298450, power: 1432, vip: null },
    { rank: 9, username: 'HashHunter', earnings: 234560, power: 1098, vip: null },
    { rank: 10, username: 'BlockChainer', earnings: 187340, power: 876, vip: null }
];

function renderLeaderboard() {
    const container = document.getElementById('leaderboardList');
    container.innerHTML = '';
    
    leaderboardData.forEach(player => {
        const item = document.createElement('div');
        item.className = 'rank-item';
        
        const rankClass = player.rank === 1 ? 'rank-1' : 
                         player.rank === 2 ? 'rank-2' : 
                         player.rank === 3 ? 'rank-3' : 'rank-other';
        
        const vipBadge = player.vip ? 
            `<span style="background: linear-gradient(135deg, #fbbf24, #f59e0b); padding: 3px 10px; border-radius: 10px; font-size: 0.8em; margin-left: 10px;">ğŸ‘‘ ${player.vip.toUpperCase()}</span>` : '';
        
        item.innerHTML = `
            <div class="rank-number ${rankClass}">
                ${player.rank <= 3 ? ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'][player.rank - 1] : '#' + player.rank}
            </div>
            <div class="rank-info">
                <div class="rank-name">${player.username}${vipBadge}</div>
                <div class="rank-stats">âš¡ ${player.power} MH/s | ğŸ“… ${currentLang === 'th' ? 'à¹ƒà¸Šà¹‰à¸‡à¸²à¸™' : 'Active'} 24/7</div>
            </div>
            <div class="rank-earnings">à¸¿${player.earnings.toLocaleString()}</div>
        `;
        
        container.appendChild(item);
    });
}

// ============ VIP System ============
let userVIP = localStorage.getItem('userVIP') || null;

function updateVIPStatus() {
    const vipStatus = document.getElementById('vipStatus');
    
    if (userVIP) {
        const vipNames = {
            bronze: 'ğŸ‘‘ Bronze VIP',
            silver: 'ğŸ’ Silver VIP',
            gold: 'ğŸŒŸ Gold VIP'
        };
        vipStatus.innerHTML = vipNames[userVIP];
    } else {
        vipStatus.innerHTML = `${currentLang === 'th' ? 'ğŸ‘¤ à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸Ÿà¸£à¸µ' : 'ğŸ‘¤ Free User'}`;
    }
}

function upgradeTo(tier) {
    const prices = {
        bronze: 99,
        silver: 299,
        gold: 999
    };
    
    const confirmed = confirm(`${currentLang === 'th' ? 'à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸­à¸±à¸à¹€à¸à¸£à¸”à¹€à¸›à¹‡à¸™' : 'Upgrade to'} ${tier.toUpperCase()} VIP ${currentLang === 'th' ? 'à¹ƒà¸™à¸£à¸²à¸„à¸²' : 'for'} à¸¿${prices[tier]} ${currentLang === 'th' ? 'à¹ƒà¸Šà¹ˆà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?' : '?'}`);
    
    if (confirmed) {
        showLoading();
        
        setTimeout(() => {
            userVIP = tier;
            localStorage.setItem('userVIP', tier);
            
            // à¸­à¸±à¸›à¹€à¸”à¸•à¸ˆà¸³à¸™à¸§à¸™à¸„à¸£à¸±à¹‰à¸‡à¸«à¸¡à¸¸à¸™à¸•à¸²à¸¡ VIP
            if (tier === 'bronze') spinsRemaining = 10;
            else if (tier === 'silver' || tier === 'gold') spinsRemaining = 999;
            
            localStorage.setItem('spinsRemaining', spinsRemaining);
            updateSpinsDisplay();
            updateVIPStatus();
            hideLoading();
            
            alert(`${currentLang === 'th' ? 'à¸¢à¸´à¸™à¸”à¸µà¸”à¹‰à¸§à¸¢! à¸„à¸¸à¸“à¹€à¸›à¹‡à¸™' : 'Congratulations! You are now'} ${tier.toUpperCase()} VIP ${currentLang === 'th' ? 'à¹à¸¥à¹‰à¸§!' : '!'} ğŸ‰`);
        }, 1500);
    }
}

updateVIPStatus();

// ============ Tab System ============
function switchTab(tab) {
    // à¸­à¸±à¸à¹€à¸”à¸— Tabs
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    event.target.closest('.tab').classList.add('active');
    
    // à¸­à¸±à¸à¹€à¸”à¸— Sections
    document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
    
    if (tab === 'wheel') {
        document.getElementById('wheelSection').classList.add('active');
    } else if (tab === 'leaderboard') {
        document.getElementById('leaderboardSection').classList.add('active');
        renderLeaderboard();
    } else if (tab === 'vip') {
        document.getElementById('vipSection').classList.add('active');
    }
}

// ============ Loading ============
function showLoading() {
    document.getElementById('loading').classList.add('active');
}

function hideLoading() {
    document.getElementById('loading').classList.remove('active');
}

// ============ à¸‹à¸´à¸‡à¸„à¹Œà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸±à¸šà¹€à¸à¸¡à¸«à¸¥à¸±à¸ ============
function syncWithMainGame() {
    const gameData = JSON.parse(localStorage.getItem('miningGameData')) || {};
    
    // à¸­à¸±à¸à¹€à¸”à¸• Leaderboard à¸”à¹‰à¸§à¸¢à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¹€à¸¥à¹ˆà¸™
    if (gameData.username && gameData.balance) {
        const userIndex = leaderboardData.findIndex(p => p.username === gameData.username);
        
        if (userIndex === -1 && gameData.balance > leaderboardData[9].earnings) {
            leaderboardData.pop();
            leaderboardData.push({
                rank: 10,
                username: gameData.username,
                earnings: gameData.balance,
                power: gameData.totalPower || 1,
                vip: userVIP
            });
            
            // à¹€à¸£à¸µà¸¢à¸‡à¹ƒà¸«à¸¡à¹ˆ
            leaderboardData.sort((a, b) => b.earnings - a.earnings);
            leaderboardData.forEach((p, i) => p.rank = i + 1);
            
            renderLeaderboard();
        }
    }
}

setInterval(syncWithMainGame, 5000);
syncWithMainGame();

// à¸›à¸´à¸” dropdown à¹€à¸¡à¸·à¹ˆà¸­à¸„à¸¥à¸´à¸à¸‚à¹‰à¸²à¸‡à¸™à¸­à¸
document.addEventListener('click', (e) => {
    if (!e.target.closest('.language-selector')) {
        document.getElementById('langDropdown').classList.remove('active');
    }
});

console.log('ğŸ° Lucky Wheel System Loaded!');
console.log('ğŸ† Leaderboard System Loaded!');
console.log('ğŸ‘‘ VIP System Loaded!');
console.log('ğŸŒ Multi-language Support Loaded!');
console.log('ğŸŒ“ Theme System Loaded!');
